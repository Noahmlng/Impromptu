# Supabaseé›†æˆä¿®å¤

## é—®é¢˜æè¿°

å‰ç«¯åœ¨è¯·æ±‚ `127.0.0.1:5003/api/profile/metadata` æ—¶è¿”å›404é”™è¯¯ï¼ŒåŸå› æ˜¯metadataæ•°æ®å­˜å‚¨åœ¨Supabaseä¸­ï¼Œä½†å‰ç«¯å´åœ¨è°ƒç”¨åç«¯APIã€‚

## è§£å†³æ–¹æ¡ˆ

### 1. æ•°æ®å­˜å‚¨æ¶æ„è°ƒæ•´

**ä¹‹å‰ï¼š** æ‰€æœ‰æ“ä½œéƒ½è°ƒç”¨åç«¯API â†’ åç«¯å†æ“ä½œSupabase  
**ç°åœ¨ï¼š** ç›´æ¥æ“ä½œSupabaseï¼ˆmetadata/tagsè¯»å–ï¼‰ + åç«¯APIï¼ˆAIåŠŸèƒ½ï¼‰

### 2. APIå®¢æˆ·ç«¯ä¿®æ”¹ (`lib/api.ts`)

#### ç›´æ¥ä½¿ç”¨Supabaseçš„æ“ä½œï¼š
- âœ… `createMetadata()` - åˆ›å»º/æ›´æ–°ç”¨æˆ·å…ƒæ•°æ®
- âœ… `getUserMetadata()` - è·å–ç”¨æˆ·å…ƒæ•°æ®  
- âœ… `batchUpdateMetadata()` - æ‰¹é‡æ›´æ–°å…ƒæ•°æ®
- âœ… `getUserTags()` - è·å–ç”¨æˆ·æ ‡ç­¾

#### ä»ä½¿ç”¨åç«¯APIçš„æ“ä½œï¼š
- ğŸ”§ `generateTags()` - AIæ ‡ç­¾ç”Ÿæˆ
- ğŸ”§ `searchMatches()` - AIåŒ¹é…æœç´¢
- ğŸ”§ `analyzeCompatibility()` - å…¼å®¹æ€§åˆ†æ

### 3. ç”¨æˆ·æ³¨å†Œæµç¨‹æ”¹è¿›

ç°åœ¨æ³¨å†Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»º `user_profile` è®°å½•ï¼š
```typescript
const userId = `user_${Date.now()}`
await supabase.from('user_profile').insert({
  user_id: userId,
  auth_user_id: data.user.id,
  email: data.user.email!,
  display_name: displayName,
  avatar_url: avatarUrl,
  status: 'active'
})
```

### 4. æ•°æ®åº“è¡¨ç»“æ„

#### user_profile
- `auth_user_id` - å…³è”Supabaseè®¤è¯ç”¨æˆ·
- `user_id` - ä¸šåŠ¡ç”¨æˆ·ID
- `display_name`, `email`, `avatar_url` ç­‰åŸºæœ¬ä¿¡æ¯

#### user_metadata  
- `user_id` - å…³è”åˆ°user_profile
- `section_type` - æ•°æ®åˆ†ç±» (å¦‚: 'profile', 'user_request')
- `section_key` - å…·ä½“å­åˆ†ç±» (å¦‚: 'personal', 'professional')
- `content` - JSONBæ ¼å¼çš„å…·ä½“å†…å®¹

#### user_tags
- `user_id` - å…³è”åˆ°user_profile  
- `tag_name` - æ ‡ç­¾åç§°
- `confidence_score` - ç½®ä¿¡åº¦è¯„åˆ†
- `tag_source` - æ ‡ç­¾æ¥æº

### 5. RLSå®‰å…¨ç­–ç•¥

Supabaseå·²é…ç½®æ­£ç¡®çš„è¡Œçº§å®‰å…¨ç­–ç•¥ï¼š
- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- é€šè¿‡ `auth.uid()` éªŒè¯èº«ä»½
- é€šè¿‡ `user_profile.auth_user_id` å…³è”æƒé™

## ä¼˜åŠ¿

### æ€§èƒ½æ”¹è¿›
- âœ… å‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè·³è½¬
- âœ… ç›´æ¥æ•°æ®åº“è®¿é—®ï¼Œå“åº”æ›´å¿«
- âœ… å‡å°‘åç«¯æœåŠ¡å™¨è´Ÿè½½

### æ¶æ„æ¸…æ™°
- ğŸ¯ æ•°æ®æ“ä½œ â†’ Supabaseç›´è¿
- ğŸ¤– AIåŠŸèƒ½ â†’ åç«¯API
- ğŸ” è®¤è¯æˆæƒ â†’ Supabase Auth

### å¼€å‘ä½“éªŒ
- ğŸ”§ å®æ—¶æ•°æ®åŒæ­¥
- ğŸ›¡ï¸ è‡ªåŠ¨çš„å®‰å…¨ç­–ç•¥
- ğŸ“Š å†…ç½®çš„æŸ¥è¯¢ä¼˜åŒ–

## æµ‹è¯•éªŒè¯

ç°åœ¨å¯ä»¥æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **ç”¨æˆ·æ³¨å†Œ** â†’ åº”è¯¥è‡ªåŠ¨åˆ›å»ºuser_profile
2. **å¡«å†™åŸºæœ¬ä¿¡æ¯** â†’ æ•°æ®åº”è¯¥ä¿å­˜åˆ°user_metadataè¡¨
3. **ç”Ÿæˆæ ‡ç­¾** â†’ è°ƒç”¨åç«¯APIï¼Œç»“æœä¿å­˜åˆ°user_tagsè¡¨
4. **æœç´¢åŒ¹é…** â†’ è°ƒç”¨åç«¯APIè¿›è¡ŒAIåŒ¹é…

## æ³¨æ„äº‹é¡¹

1. **åç«¯APIä¾ç„¶éœ€è¦è¿è¡Œ** - ç”¨äºAIåŠŸèƒ½ï¼ˆæ ‡ç­¾ç”Ÿæˆã€åŒ¹é…æœç´¢ï¼‰
2. **ç¯å¢ƒå˜é‡** - ç¡®ä¿Supabase URLå’Œå¯†é’¥æ­£ç¡®é…ç½®
3. **ç”¨æˆ·æƒé™** - æ–°æ³¨å†Œç”¨æˆ·éœ€è¦ç¡®ä¿user_profileè®°å½•åˆ›å»ºæˆåŠŸ

## é”™è¯¯å¤„ç†

- åŠ å¼ºäº†Supabaseæ“ä½œçš„é”™è¯¯æ•è·
- æ³¨å†Œæ—¶profileåˆ›å»ºå¤±è´¥ä¸ä¼šé˜»å¡æ•´ä¸ªæ³¨å†Œæµç¨‹
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ç”¨äºè°ƒè¯•

## ä¸‹ä¸€æ­¥

å¯ä»¥è€ƒè™‘è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š
- ä½¿ç”¨Supabaseå®æ—¶åŠŸèƒ½åŒæ­¥æ•°æ®å˜æ›´
- ç¼“å­˜å¸¸ç”¨çš„æ ‡ç­¾å’Œå…ƒæ•°æ®
- å®ç°ç¦»çº¿æ•°æ®åŒæ­¥æœºåˆ¶ 